# GraphAlign Configuration
# Graph-Based Multi-Modal Alignment

# Modality configuration
modalities:
  - image
  - text
  - point

modality_input_dims:
  image: 768
  text: 768
  point: 768

# Encoder backbone
encoder:
  hidden_dim: 512
  output_dim: 512
  num_layers: 4
  num_heads: 8
  dropout: 0.1

# Graph pooling
pooling:
  target_length: 32    # N - number of graph nodes
  graph_dim: 256       # dgraph - node feature dimension
  num_heads: 8
  dropout: 0.0

# Graph expansion
expansion:
  order: 3             # P - polynomial order

# Fusion
fusion:
  # Inherits order from expansion

# Classification (set 0 to disable fusion classification loss)
num_classes: 40

# Teacher distillation
use_teacher: false

# Training
training:
  # Optimizer
  optimizer: adamw
  learning_rate: 2.0e-4
  weight_decay: 0.05
  betas: [0.9, 0.999]
  eps: 1.0e-8

  # Scheduler
  scheduler: cosine
  warmup_steps: 2000
  min_lr: 0.0

  # Batch and epochs
  batch_size: 256
  accum_iter: 4
  epochs: 100

  # Loss weights
  lambda_1_graph_nce: 1.0
  lambda_2_fusion: 1.0
  lambda_3_soft_bind: 1.0
  lambda_4_anchor: 1.0
  lambda_5_teacher: 1.0
  lambda_6_reg: 0.01

  # Contrastive temperature
  temperature: 0.07

  # Graph regularization sub-weights
  lambda_sparse: 0.01
  lambda_cluster: 0.01
  lambda_rank: 0.01

  # Mixed precision
  use_amp: true

  # Gradient clipping
  max_grad_norm: 1.0

  # Logging
  log_interval: 50
  save_interval: 1000

# Data (example paths - adjust to your setup)
data:
  image_seq_len: 197   # ViT: 196 patches + 1 cls token
  text_seq_len: 77     # CLIP text length
  point_seq_len: 1024  # Point cloud tokens

# Output
output_dir: ./output/graphalign
checkpoint_dir: ./output/graphalign/checkpoints
log_dir: ./output/graphalign/logs
